name: Simulated Deploy Pipeline

on:
  push:
    branches:
      - master
      - develop

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set environment name
        run: |
          if [ "${GITHUB_REF_NAME}" = "master" ]; then
            echo "ENVIRONMENT=prod" >> $GITHUB_ENV
          else
            echo "ENVIRONMENT=dev" >> $GITHUB_ENV
          fi

      - name: Set version
        run: echo "VERSION=${GITHUB_SHA::7}" >> $GITHUB_ENV

      - name: Build Docker image
        run: docker build -t demo-app:${{ env.VERSION }} .

      - name: Deploy (simulate)
        run: |
          docker run \
            -e ENVIRONMENT=${{ env.ENVIRONMENT }} \
            -e VERSION=${{ env.VERSION }} \
            demo-app:${{ env.VERSION }}
